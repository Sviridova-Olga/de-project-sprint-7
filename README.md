# Проектная работа по организации Data Lake

### Описание задачи
В приложение планируют внедрить систему рекомендации друзей. Оно будет предлагать пользователю написать человеку, если пользователь и адресат:  
	  
  * состоят в одном канале,	 
  * раньше никогда не переписывались,    
  * находятся не дальше 1 км друг от друга.  

При этом команда хочет лучше изучить аудиторию соцсети, чтобы в будущем запустить монетизацию. Для этого было решено провести геоаналитику:  
  * Выяснить, где находится большинство пользователей по количеству сообщений, лайков и подписок из одной точки.  
  * Посмотреть, в какой точке Австралии регистрируется больше всего новых пользователей.  
  * Определить, как часто пользователи путешествуют и какие города выбирают.  

Необходимо построить 3 витрины и автоматизировать их обновление.  
1. Витрина в разрезе пользователей. Состоит из шести полей:  
	
	user_id — идентификатор пользователя.  
	act_city — актуальный адрес. Это город, из которого было отправлено последнее сообщение.  
	home_city — домашний адрес. Это последний город, в котором пользователь был дольше 27 дней  
	travel_count — количество посещённых городов.     
	travel_array — список городов в порядке посещения.  
    local_time — местное время.  


2. Витрина в разрезе зон. Нужно посчитать количество событий в конкретном городе за неделю и месяц. Содержит следующие поля:  
	month — месяц расчёта;  
	week — неделя расчёта;  
	zone_id — идентификатор зоны (города);  
	week_message — количество сообщений за неделю;  
	week_reaction — количество реакций за неделю;  
	week_subscription — количество подписок за неделю;  
	week_user — количество регистраций за неделю;  
	month_message — количество сообщений за месяц;  
	month_reaction — количество реакций за месяц;  
	month_subscription — количество подписок за месяц;  
	month_user — количество регистраций за месяц.  

  
3. Витрина для рекомендации друзей. Нужно найти уникальные пары пользователей, которые подписаны на один канал, ранее никогда не переписывались и расстояние между ними не превышает 1 км.
Витрина должна содержать следующие поля:  
    user_left — первый пользователь;  
    user_right — второй пользователь;  
    processed_dttm — дата расчёта витрины;  
    zone_id — идентификатор зоны (города);  
    local_time — локальное время.  

### Входные данные

Файл geo.csv. В нём содержатся координаты городов Австралии.  

Таблица событий. Находится в HDFS по пути: /user/master/data/geo/events  
Структура таблицы событий:  

	root  
	 |-- event: struct (nullable = true) - структура события;  
	 |  |-- admins: array (nullable = true) - массив пользователей-админов канала;  
	 |  |  |-- element: long (containsNull = true) - идентификатор пользователя;  
	 |  |-- channel_id: long (nullable = true) - идентификатор канала;  
	 |  |-- datetime: string (nullable = true) - дата и время сообщения;  
	 |  |-- media: struct (nullable = true) - информация о вложении;  
	 |  |  |-- media_type: string (nullable = true) - тип вложения;  
	 |  |  |-- src: string (nullable = true) - ссылка на вложение;  
	 |  |-- message: string (nullable = true) - текст сообщения;  
	 |  |-- message_channel_to: long (nullable = true) - идентификатор канала сообщения;  
	 |  |-- message_from: long (nullable = true) - идентификатор отправителя;  
	 |  |-- message_group: long (nullable = true) - идентификатор группы;  
	 |  |-- message_id: long (nullable = true) - идентификатор сообщения;  
	 |  |-- message_to: long (nullable = true) - идентификатор получателя;  
	 |  |-- message_ts: string (nullable = true) - метка времени сообщения;  
	 |  |-- reaction_from: string (nullable = true) - идентификатор пользователя реакции;  
	 |  |-- reaction_type: string (nullable = true) - тип реакции;  
	 |  |-- subscription_channel: long (nullable = true) - идентификатор подписки на канал;  
	 |  |-- subscription_user: string (nullable = true) - идентификатор подписки на пользователя;  
	 |  |-- tags: array (nullable = true) - массив тегов сообщения;  
	 |  |  |-- element: string (containsNull = true) - значение тега;  
	 |  |-- user: string (nullable = true) - идентификатор пользователя подписки;  
	 |-- event_type: string (nullable = true) - тип события;  
	 |-- lat: double (nullable = true) - географическая широта события;  
	 |-- lon: double (nullable = true) - географическая долгота события;  
	 |-- date: date (nullable = true) - дата события;  

